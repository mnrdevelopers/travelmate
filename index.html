<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelMate - Trip Management</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Lottie Player -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --danger-color: #e63946;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .splash-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
        }
        
        .splash-content {
            text-align: center;
            color: white;
        }
        
        .splash-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
        }
        
        .auth-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 450px;
        }
        
        .auth-header {
            background: var(--primary-color);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .auth-body {
            padding: 30px;
        }
            
            itineraryDays.innerHTML = '';
            Object.keys(activitiesByDay).forEach(day => {
                const dayCard = document.createElement('div');
                dayCard.className = 'card itinerary-card mb-3';
                
                dayCard.innerHTML = `
                    <div class="card-header">
                        <h5 class="mb-0">Day ${day}</h5>
                    </div>
                    <div class="card-body">
                        ${activitiesByDay[day].map(activity => `
                            <div class="d-flex mb-3">
                                <div class="me-3">
                                    <strong>${activity.time}</strong>
                                </div>
                                <div>
                                    <h6 class="mb-1">${activity.place}</h6>
                                    <p class="mb-0 text-muted">${activity.notes || ''}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                itineraryDays.appendChild(dayCard);
            });
        }
        
        function loadTripRoute(trip) {
            if (trip.route) {
                displayRouteDetails(trip.route);
            } else {
                document.getElementById('route-details').innerHTML = '';
                document.getElementById('empty-route').classList.remove('d-none');
            }
        }
        
        async function saveExpense() {
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const category = document.getElementById('expense-category').value;
            const date = document.getElementById('expense-date').value;
            
            if (!description || !amount || !category || !date) {
                alert('Please fill in all fields');
                return;
            }
            
            const expense = {
                description,
                amount,
                category,
                date,
                addedBy: currentUser.uid,
                addedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // Update the trip document with the new expense
                await db.collection('trips').doc(currentTrip.id).update({
                    expenses: firebase.firestore.FieldValue.arrayUnion(expense)
                });
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addExpenseModal'));
                modal.hide();
                
                // Reset form
                document.getElementById('add-expense-form').reset();
                
                // Reload trip details
                const updatedTrip = await db.collection('trips').doc(currentTrip.id).get();
                showTripDetails({
                    id: updatedTrip.id,
                    ...updatedTrip.data()
                });
            } catch (error) {
                console.error('Error adding expense:', error);
                alert('Error adding expense. Please try again.');
            }
        }
        
        async function saveActivity() {
            const day = parseInt(document.getElementById('activity-day').value);
            const time = document.getElementById('activity-time').value;
            const place = document.getElementById('activity-place').value;
            const notes = document.getElementById('activity-notes').value;
            
            if (!day || !time || !place) {
                alert('Please fill in all required fields');
                return;
            }
            
            const activity = {
                day,
                time,
                place,
                notes,
                addedBy: currentUser.uid,
                addedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // Update the trip document with the new activity
                await db.collection('trips').doc(currentTrip.id).update({
                    itinerary: firebase.firestore.FieldValue.arrayUnion(activity)
                });
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addActivityModal'));
                modal.hide();
                
                // Reset form
                document.getElementById('add-activity-form').reset();
                
                // Reload trip details
                const updatedTrip = await db.collection('trips').doc(currentTrip.id).get();
                showTripDetails({
                    id: updatedTrip.id,
                    ...updatedTrip.data()
                });
            } catch (error) {
                console.error('Error adding activity:', error);
                alert('Error adding activity. Please try again.');
            }
        }
    </script>
</body>
</html>
